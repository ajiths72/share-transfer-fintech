openapi: 3.0.3
info:
  title: FinShare Transfer API
  version: 2.1.0
  description: API for online share transfer plus market buys and limit buys, with maker-checker approvals, TOTP 2FA, and session revocation.
servers:
  - url: http://localhost:8080
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: SignedToken
  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
paths:
  /api/health:
    get:
      summary: Health check
      responses:
        '200':
          description: Healthy
  /api/register:
    post:
      summary: Register account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string }
                password: { type: string }
                role: { type: string, enum: [TRADER, COMPLIANCE] }
      responses:
        '201':
          description: Token returned
  /api/login:
    post:
      summary: Login (requires OTP if 2FA enabled)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string }
                password: { type: string }
                otp: { type: string }
      responses:
        '200':
          description: Token returned
        '202':
          description: OTP required
  /api/logout:
    post:
      summary: Revoke current session
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Logged out }
  /api/me:
    get:
      summary: Current user
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: User details }
  /api/2fa/setup:
    post:
      summary: Generate 2FA secret
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Secret returned }
  /api/2fa/enable:
    post:
      summary: Enable 2FA with OTP
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Enabled }
  /api/2fa/disable:
    post:
      summary: Disable 2FA with OTP
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Disabled }
  /api/sessions:
    get:
      summary: List own sessions
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Sessions listed }
  /api/sessions/revoke:
    post:
      summary: Revoke a single own session
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Revoked }
  /api/sessions/revoke-all:
    post:
      summary: Revoke all own sessions
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Revoked all }
  /api/portfolios:
    get:
      summary: Get portfolio view
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Portfolio list }
  /api/transfers:
    get:
      summary: List transfers
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Transfer list }
    post:
      summary: Create transfer
      security: [{ bearerAuth: [] }]
      responses:
        '201': { description: Created }
  /api/transfers/{id}/approve:
    post:
      summary: Approve transfer
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Approved }
  /api/transfers/{id}/reject:
    post:
      summary: Reject transfer
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Rejected }
  /api/transfers/{id}/execute:
    post:
      summary: Execute transfer settlement
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Executed }
  /api/market/symbols:
    get:
      summary: List active listed symbols with last prices
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Symbol list }
  /api/market/orders:
    get:
      summary: List market orders (own orders for traders, all for admin/compliance)
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Market orders }
  /api/market/buy:
    post:
      summary: Execute market buy for a listed symbol
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [symbol, quantity]
              properties:
                symbol: { type: string }
                quantity: { type: integer }
      responses:
        '201': { description: Market order executed }
  /api/market/limit-buy:
    post:
      summary: Place a limit buy order for a listed symbol
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [symbol, quantity, limit_price]
              properties:
                symbol: { type: string }
                quantity: { type: integer }
                limit_price: { type: number }
      responses:
        '201': { description: Limit order created (or executed) }
  /api/market/limit-orders:
    get:
      summary: List limit buy orders (own for traders, all for admin/compliance)
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Limit orders }
  /api/market/limit-orders/{id}/cancel:
    post:
      summary: Cancel a pending limit order
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: Canceled }
